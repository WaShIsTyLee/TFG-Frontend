<ion-header>
  <ion-title>Parkings</ion-title>
</ion-header>

<ion-content>
  <!-- Primera sección: Parkings cercanos -->
  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <h2 class="section-title">Parkings Cercanos</h2>
      </ion-col>

      <!-- Si hay parkings cercanos los mostramos -->
      <ng-container *ngIf="parkingsCercanos.length > 0; else noCercanos">
        <ng-container *ngFor="let parking of parkingsCercanos">
          <ion-col size="12" size-md="6" size-lg="4">
            <ion-card>
              <ion-card-header>
                <ion-card-title>{{ parking.nombre }}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <p>{{ parking.ubicacion }}</p>
                
                <!-- Botón para abrir un modal con mapa -->
                <ion-button expand="block" class="btn-ticket" (click)="openMapaModal(parking)">
                  Ver mapa
                </ion-button>
                
                <!-- Botón para cargar plazas y reservar -->
                <ion-button expand="block" class="btn-eliminar" (click)="loadPlazas(parking.idParking)">
                  Reservar
                </ion-button>
                
                <!-- Botones visibles solo si el usuario es admin -->
                <ion-button *ngIf="isAdmin" expand="block" class="btn-ticket" (click)="addPlaza(parking.idParking)">
                  Añadir plaza
                </ion-button>
                <ion-button *ngIf="isAdmin" expand="block" class="btn-ticket" (click)="deleteParking(parking.idParking)">
                  Eliminar
                </ion-button>
                
                <!-- Mostrar botón para borrar plazas solo si hay plazas y es admin -->
                <ion-button *ngIf="isAdmin && getPlazasPorParking(parking.idParking).length > 0" class="btn-ticket" expand="block" (click)="showDeletePlazasAlert(parking.idParking)">
                  Borrar plazas
                </ion-button>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ng-container>
      </ng-container>

      <!-- Mensaje si no hay parkings cercanos -->
      <ng-template #noCercanos>
        <ion-col size="12">
          <p>No hay parkings cercanos a tu ubicación.</p>
        </ion-col>
      </ng-template>
    </ion-row>
  </ion-grid>

  <!-- Segunda sección: Todos los parkings -->
  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <h2 class="section-title">Todos los Parkings</h2>
      </ion-col>

      <!-- Listamos todos los parkings sin filtro -->
      <ng-container *ngFor="let parking of parkings">
        <ion-col size="12" size-md="6" size-lg="4">
          <ion-card>
            <ion-card-header>
              <ion-card-title>{{ parking.nombre }}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p>{{ parking.ubicacion }}</p>
              <ion-button expand="block" class="btn-ticket" (click)="openMapaModal(parking)">
                Ver mapa
              </ion-button>
              <ion-button expand="block" class="btn-eliminar" (click)="loadPlazas(parking.idParking)">
                Reservar
              </ion-button>
              <ion-button *ngIf="isAdmin" expand="block" class="btn-ticket" (click)="addPlaza(parking.idParking)">
                Añadir plaza
              </ion-button>
              <ion-button *ngIf="isAdmin" expand="block" class="btn-ticket" (click)="deleteParking(parking.idParking)">
                Eliminar
              </ion-button>
              <ion-button *ngIf="isAdmin && getPlazasPorParking(parking.idParking).length > 0" class="btn-ticket" expand="block" (click)="showDeletePlazasAlert(parking.idParking)">
                Borrar plazas
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ng-container>
    </ion-row>
  </ion-grid>

  <!-- Botón flotante para añadir parkings, solo visible para admin -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="isAdmin">
    <ion-fab-button (click)="addParking()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>
